import{L as k,a as S,f as y,i as L,t as U,u as H}from"./chunk-M7G2GFUC.js";import{f as q,g as P}from"./chunk-VX6DIAJP.js";import{a as T}from"./chunk-QRWHQ7IS.js";import{a as v,c as i,f as E}from"./chunk-2B6HUC56.js";var I=i(c=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});c.checkUrl=void 0;var b=T(),K="169.254.170.2",F="169.254.170.23",W="[fd00:ec2::23]",D=(e,o)=>{if(e.protocol!=="https:"&&!(e.hostname===K||e.hostname===F||e.hostname===W)){if(e.hostname.includes("[")){if(e.hostname==="[::1]"||e.hostname==="[0000:0000:0000:0000:0000:0000:0000:0001]")return}else{if(e.hostname==="localhost")return;let n=e.hostname.split("."),r=t=>{let s=parseInt(t,10);return 0<=s&&s<=255};if(n[0]==="127"&&r(n[1])&&r(n[2])&&r(n[3])&&n.length===4)return}throw new b.CredentialsProviderError(`URL not accepted. It must either be HTTPS or match one of the following:
  - loopback CIDR 127.0.0.0/8 or [::1/128]
  - ECS container host 169.254.170.2
  - EKS container host 169.254.170.23 or [fd00:ec2::23]`,{logger:o})}};c.checkUrl=D});var f=i(d=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0});d.createGetRequest=x;d.getCredentials=Z;var C=T(),j=S(),z=k(),M=L();function x(e){return new j.HttpRequest({protocol:e.protocol,hostname:e.hostname,port:Number(e.port),path:e.pathname,query:Array.from(e.searchParams.entries()).reduce((o,[n,r])=>(o[n]=r,o),{}),fragment:e.hash})}async function Z(e,o){let r=await(0,M.sdkStreamMixin)(e.body).transformToString();if(e.statusCode===200){let t=JSON.parse(r);if(typeof t.AccessKeyId!="string"||typeof t.SecretAccessKey!="string"||typeof t.Token!="string"||typeof t.Expiration!="string")throw new C.CredentialsProviderError("HTTP credential provider response not of the required format, an object matching: { AccessKeyId: string, SecretAccessKey: string, Token: string, Expiration: string(rfc3339) }",{logger:o});return{accessKeyId:t.AccessKeyId,secretAccessKey:t.SecretAccessKey,sessionToken:t.Token,expiration:(0,z.parseRfc3339DateTime)(t.Expiration)}}if(e.statusCode>=400&&e.statusCode<500){let t={};try{t=JSON.parse(r)}catch{}throw Object.assign(new C.CredentialsProviderError(`Server responded with status: ${e.statusCode}`,{logger:o}),{Code:t.Code,Message:t.Message})}throw new C.CredentialsProviderError(`Server responded with status: ${e.statusCode}`,{logger:o})}});var m=i(u=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0});u.retryWrapper=void 0;var $=(e,o,n)=>async()=>{for(let r=0;r<o;++r)try{return await e()}catch{await new Promise(s=>setTimeout(s,n))}return await e()};u.retryWrapper=$});var w=i(_=>{"use strict";Object.defineProperty(_,"__esModule",{value:!0});_.fromHttp=void 0;var B=(H(),E(U)),G=(P(),E(q)),V=y(),N=T(),J=B.__importDefault(v("fs/promises")),Q=I(),R=f(),X=m(),Y="AWS_CONTAINER_CREDENTIALS_RELATIVE_URI",ee="http://169.254.170.2",te="AWS_CONTAINER_CREDENTIALS_FULL_URI",re="AWS_CONTAINER_AUTHORIZATION_TOKEN_FILE",oe="AWS_CONTAINER_AUTHORIZATION_TOKEN",ne=(e={})=>{e.logger?.debug("@aws-sdk/credential-provider-http - fromHttp");let o,n=e.awsContainerCredentialsRelativeUri??process.env[Y],r=e.awsContainerCredentialsFullUri??process.env[te],t=e.awsContainerAuthorizationToken??process.env[oe],s=e.awsContainerAuthorizationTokenFile??process.env[re],a=e.logger?.constructor?.name==="NoOpLogger"||!e.logger?.warn?console.warn:e.logger.warn.bind(e.logger);if(n&&r&&(a("@aws-sdk/credential-provider-http: you have set both awsContainerCredentialsRelativeUri and awsContainerCredentialsFullUri."),a("awsContainerCredentialsFullUri will take precedence.")),t&&s&&(a("@aws-sdk/credential-provider-http: you have set both awsContainerAuthorizationToken and awsContainerAuthorizationTokenFile."),a("awsContainerAuthorizationToken will take precedence.")),r)o=r;else if(n)o=`${ee}${n}`;else throw new N.CredentialsProviderError(`No HTTP credential provider host provided.
Set AWS_CONTAINER_CREDENTIALS_FULL_URI or AWS_CONTAINER_CREDENTIALS_RELATIVE_URI.`,{logger:e.logger});let A=new URL(o);(0,Q.checkUrl)(A,e.logger);let O=V.NodeHttpHandler.create({requestTimeout:e.timeout??1e3,connectionTimeout:e.timeout??1e3});return(0,X.retryWrapper)(async()=>{let p=(0,R.createGetRequest)(A);t?p.headers.Authorization=t:s&&(p.headers.Authorization=(await J.default.readFile(s)).toString());try{let h=await O.handle(p);return(0,R.getCredentials)(h.response).then(g=>(0,G.setCredentialFeature)(g,"CREDENTIALS_HTTP","z"))}catch(h){throw new N.CredentialsProviderError(String(h),{logger:e.logger})}},e.maxRetries??3,e.timeout??1e3)};_.fromHttp=ne});var ie=i(l=>{Object.defineProperty(l,"__esModule",{value:!0});l.fromHttp=void 0;var se=w();Object.defineProperty(l,"fromHttp",{enumerable:!0,get:function(){return se.fromHttp}})});export{ie as a};
//# sourceMappingURL=chunk-4XEPMHA3.js.map
