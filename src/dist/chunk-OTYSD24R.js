import{a as k}from"./chunk-HHIBTEH3.js";import{a as u,c as g}from"./chunk-2B6HUC56.js";var T=g(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0});h.getHomeDir=void 0;var x=u("os"),A=u("path"),P={},q=()=>process&&process.geteuid?`${process.geteuid()}`:"DEFAULT",$=()=>{let{HOME:e,USERPROFILE:t,HOMEPATH:r,HOMEDRIVE:n=`C:${A.sep}`}=process.env;if(e)return e;if(t)return t;if(r)return`${n}${r}`;let i=q();return P[i]||(P[i]=(0,x.homedir)()),P[i]};h.getHomeDir=$});var b=g(O=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0});O.getSSOTokenFilepath=void 0;var M=u("crypto"),K=u("path"),W=T(),V=e=>{let r=(0,M.createHash)("sha1").update(e).digest("hex");return(0,K.join)((0,W.getHomeDir)(),".aws","sso","cache",`${r}.json`)};O.getSSOTokenFilepath=V});var j=g(a=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.getSSOTokenFromFile=a.tokenIntercept=void 0;var G=u("fs"),U=b(),{readFile:X}=G.promises;a.tokenIntercept={};var B=async e=>{if(a.tokenIntercept[e])return a.tokenIntercept[e];let t=(0,U.getSSOTokenFilepath)(e),r=await X(t,"utf8");return JSON.parse(r)};a.getSSOTokenFromFile=B});var y=g(c=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});c.slurpFile=c.fileIntercept=c.filePromisesHash=void 0;var J=u("fs"),{readFile:z}=J.promises;c.filePromisesHash={};c.fileIntercept={};var Q=(e,t)=>c.fileIntercept[e]!==void 0?c.fileIntercept[e]:((!c.filePromisesHash[e]||t?.ignoreCache)&&(c.filePromisesHash[e]=z(e,"utf8")),c.filePromisesHash[e]);c.slurpFile=Q});var fe=g(o=>{"use strict";var F=T(),H=b(),v=j(),m=u("path"),_=k(),S=y(),R="AWS_PROFILE",w="default",Y=e=>e.profile||process.env[R]||w,f=".",Z=e=>Object.entries(e).filter(([t])=>{let r=t.indexOf(f);return r===-1?!1:Object.values(_.IniSectionType).includes(t.substring(0,r))}).reduce((t,[r,n])=>{let i=r.indexOf(f),s=r.substring(0,i)===_.IniSectionType.PROFILE?r.substring(i+1):r;return t[s]=n,t},{...e.default&&{default:e.default}}),ee="AWS_CONFIG_FILE",L=()=>process.env[ee]||m.join(F.getHomeDir(),".aws","config"),te="AWS_SHARED_CREDENTIALS_FILE",re=()=>process.env[te]||m.join(F.getHomeDir(),".aws","credentials"),ne=/^([\w-]+)\s(["'])?([\w-@\+\.%:/]+)\2$/,ie=["__proto__","profile __proto__"],D=e=>{let t={},r,n;for(let i of e.split(/\r?\n/)){let s=i.split(/(^|\s)[;#]/)[0].trim();if(s[0]==="["&&s[s.length-1]==="]"){r=void 0,n=void 0;let l=s.substring(1,s.length-1),p=ne.exec(l);if(p){let[,d,,E]=p;Object.values(_.IniSectionType).includes(d)&&(r=[d,E].join(f))}else r=l;if(ie.includes(l))throw new Error(`Found invalid profile name "${l}"`)}else if(r){let l=s.indexOf("=");if(![0,-1].includes(l)){let[p,d]=[s.substring(0,l).trim(),s.substring(l+1).trim()];if(d==="")n=p;else{n&&i.trimStart()===i&&(n=void 0),t[r]=t[r]||{};let E=n?[n,p].join(f):p;t[r][E]=d}}}}return t},C=()=>({}),N=async(e={})=>{let{filepath:t=re(),configFilepath:r=L()}=e,n=F.getHomeDir(),i="~/",s=t;t.startsWith(i)&&(s=m.join(n,t.slice(2)));let I=r;r.startsWith(i)&&(I=m.join(n,r.slice(2)));let l=await Promise.all([S.slurpFile(I,{ignoreCache:e.ignoreCache}).then(D).then(Z).catch(C),S.slurpFile(s,{ignoreCache:e.ignoreCache}).then(D).catch(C)]);return{configFile:l[0],credentialsFile:l[1]}},oe=e=>Object.entries(e).filter(([t])=>t.startsWith(_.IniSectionType.SSO_SESSION+f)).reduce((t,[r,n])=>({...t,[r.substring(r.indexOf(f)+1)]:n}),{}),se=()=>({}),ce=async(e={})=>S.slurpFile(e.configFilepath??L()).then(D).then(oe).catch(se),le=(...e)=>{let t={};for(let r of e)for(let[n,i]of Object.entries(r))t[n]!==void 0?Object.assign(t[n],i):t[n]=i;return t},ae=async e=>{let t=await N(e);return le(t.configFile,t.credentialsFile)},ue={getFileRecord(){return S.fileIntercept},interceptFile(e,t){S.fileIntercept[e]=Promise.resolve(t)},getTokenRecord(){return v.tokenIntercept},interceptToken(e,t){v.tokenIntercept[e]=t}};Object.defineProperty(o,"getSSOTokenFromFile",{enumerable:!0,get:function(){return v.getSSOTokenFromFile}});o.CONFIG_PREFIX_SEPARATOR=f;o.DEFAULT_PROFILE=w;o.ENV_PROFILE=R;o.externalDataInterceptor=ue;o.getProfileName=Y;o.loadSharedConfigFiles=N;o.loadSsoSessionData=ce;o.parseKnownFiles=ae;Object.keys(F).forEach(function(e){e!=="default"&&!Object.prototype.hasOwnProperty.call(o,e)&&Object.defineProperty(o,e,{enumerable:!0,get:function(){return F[e]}})});Object.keys(H).forEach(function(e){e!=="default"&&!Object.prototype.hasOwnProperty.call(o,e)&&Object.defineProperty(o,e,{enumerable:!0,get:function(){return H[e]}})})});export{fe as a};
//# sourceMappingURL=chunk-OTYSD24R.js.map
