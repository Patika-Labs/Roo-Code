import{a as v}from"./chunk-OTYSD24R.js";import{f as P,g as f}from"./chunk-VX6DIAJP.js";import{a as E}from"./chunk-QRWHQ7IS.js";import{a,c as w,f as p}from"./chunk-2B6HUC56.js";var I=w(u=>{var d=v(),t=E(),h=a("child_process"),x=a("util"),y=(f(),p(P)),S=(r,e,s)=>{if(e.Version!==1)throw Error(`Profile ${r} credential_process did not return Version 1.`);if(e.AccessKeyId===void 0||e.SecretAccessKey===void 0)throw Error(`Profile ${r} credential_process returned invalid credentials.`);if(e.Expiration){let i=new Date;if(new Date(e.Expiration)<i)throw Error(`Profile ${r} credential_process returned expired credentials.`)}let n=e.AccountId;!n&&s?.[r]?.aws_account_id&&(n=s[r].aws_account_id);let o={accessKeyId:e.AccessKeyId,secretAccessKey:e.SecretAccessKey,...e.SessionToken&&{sessionToken:e.SessionToken},...e.Expiration&&{expiration:new Date(e.Expiration)},...e.CredentialScope&&{credentialScope:e.CredentialScope},...n&&{accountId:n}};return y.setCredentialFeature(o,"CREDENTIALS_PROCESS","w"),o},_=async(r,e,s)=>{let n=e[r];if(e[r]){let o=n.credential_process;if(o!==void 0){let i=x.promisify(d.externalDataInterceptor?.getTokenRecord?.().exec??h.exec);try{let{stdout:c}=await i(o),l;try{l=JSON.parse(c.trim())}catch{throw Error(`Profile ${r} credential_process returned invalid JSON.`)}return S(r,l,e)}catch(c){throw new t.CredentialsProviderError(c.message,{logger:s})}}else throw new t.CredentialsProviderError(`Profile ${r} did not contain credential_process.`,{logger:s})}else throw new t.CredentialsProviderError(`Profile ${r} could not be found in shared credentials file.`,{logger:s})},C=(r={})=>async({callerClientConfig:e}={})=>{r.logger?.debug("@aws-sdk/credential-provider-process - fromProcess");let s=await d.parseKnownFiles(r);return _(d.getProfileName({profile:r.profile??e?.profile}),s,r.logger)};u.fromProcess=C});export{I as a};
//# sourceMappingURL=chunk-VKLNVDVZ.js.map
