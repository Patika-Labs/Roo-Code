import{c as x}from"./chunk-MKRX7O3O.js";import{b as S,e as z}from"./chunk-2B6HUC56.js";var v,g,w=S(()=>{v=z(x()),g=class{marshaller;serializer;deserializer;serdeContext;defaultContentType;constructor({marshaller:s,serializer:i,deserializer:n,serdeContext:o,defaultContentType:l}){this.marshaller=s,this.serializer=i,this.deserializer=n,this.serdeContext=o,this.defaultContentType=l}async serializeEventStream({eventStream:s,requestSchema:i,initialRequest:n}){let o=this.marshaller,l=i.getEventStreamMember(),u=i.getMemberSchema(l),c=this.serializer,m=this.defaultContentType,y=Symbol("initialRequestMarker"),d={async*[Symbol.asyncIterator](){if(n){let r={":event-type":{type:"string",value:"initial-request"},":message-type":{type:"string",value:"event"},":content-type":{type:"string",value:m}};c.write(i,n);let t=c.flush();yield{[y]:!0,headers:r,body:t}}for await(let r of s)yield r}};return o.serialize(d,r=>{if(r[y])return{headers:r.headers,body:r.body};let t=Object.keys(r).find(h=>h!=="__type")??"",{additionalHeaders:e,body:a,eventType:p,explicitPayloadContentType:b}=this.writeEventBody(t,u,r);return{headers:{":event-type":{type:"string",value:p},":message-type":{type:"string",value:"event"},":content-type":{type:"string",value:b??m},...e},body:a}})}async deserializeEventStream({response:s,responseSchema:i,initialResponseContainer:n}){let o=this.marshaller,l=i.getEventStreamMember(),c=i.getMemberSchema(l).getMemberSchemas(),m=Symbol("initialResponseMarker"),y=o.deserialize(s.body,async t=>{let e=Object.keys(t).find(a=>a!=="__type")??"";if(e==="initial-response"){let a=await this.deserializer.read(i,t[e].body);return delete a[l],{[m]:!0,...a}}else if(e in c){let a=c[e];return{[e]:await this.deserializer.read(a,t[e].body)}}else return{$unknown:t}}),d=y[Symbol.asyncIterator](),r=await d.next();if(r.done)return y;if(r.value?.[m]){if(!i)throw new Error("@smithy::core/protocols - initial-response event encountered in event stream but no response schema given.");for(let[t,e]of Object.entries(r.value))n[t]=e}return{async*[Symbol.asyncIterator](){for(r?.value?.[m]||(yield r.value);;){let{done:t,value:e}=await d.next();if(t)break;yield e}}}}writeEventBody(s,i,n){let o=this.serializer,l=s,u=null,c,m=i.getSchema()[4].includes(s),y={};if(m){let t=i.getMemberSchema(s);if(t.isStructSchema()){for(let[e,a]of t.structIterator()){let{eventHeader:p,eventPayload:b}=a.getMergedTraits();if(b){u=e;break}else if(p){let f=n[s][e],h="binary";a.isNumericSchema()?(-2)**31<=f&&f<=2**31-1?h="integer":h="long":a.isTimestampSchema()?h="timestamp":a.isStringSchema()?h="string":a.isBooleanSchema()&&(h="boolean"),f!=null&&(y[e]={type:h,value:f},delete n[s][e])}}if(u!==null){let e=t.getMemberSchema(u);e.isBlobSchema()?c="application/octet-stream":e.isStringSchema()&&(c="text/plain"),o.write(e,n[s][u])}else o.write(t,n[s])}else throw new Error("@smithy/core/event-streams - non-struct member not supported in event stream union.")}else{let[t,e]=n[s];l=t,o.write(15,e)}let d=o.flush();return{body:typeof d=="string"?(this.serdeContext?.utf8Decoder??v.fromUtf8)(d):d,eventType:l,explicitPayloadContentType:c,additionalHeaders:y}}}});var k=S(()=>{w()});k();export{g as EventStreamSerde};
//# sourceMappingURL=event-streams-WDCPP52X.js.map
